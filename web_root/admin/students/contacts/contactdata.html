~[if#req.~[gpv:action]=]
<!DOCTYPE html>
<html>
<head>
<meta http-equiv="REFRESH" content="0;URL=/admin/students/contacts/studentcontacts.html?frn=~(studentfrn)" />
</head>
<body>
</body>
</html>
[/if#req]
~[if#req.~[gpv:action]=getcontact]
~[tlist_sql;
    SELECT
        contact_id,
first_name,
last_name,
relationship,
residence_street,
residence_city,
residence_state,
residence_zip,
email,
phone1,
phone2,
phone3,
employer,
        id,
        legal_guardian,
        mailing_city,
        mailing_state,
        mailing_street,
        mailing_zip,
        phone1type,
        phone2type,
        phone3type,
        priority
    FROM u_student_contacts4
    WHERE contact_id=~[gpv:gidx]
    AND studentsdcid=~[gpv:sdcid]
    ORDER BY contact_id asc]
[
	"~[gpv:gidx]",
	{
		"priority":"~(priority;js)",
		"firstname":"~(first_name;js)",
		"lastname":"~(last_name;js)",
		"relation":"~(relationship;js)"
	},
	{
		"street":"~(residence_street;js)",
		"city":"~(residence_city;js)",
		"state":"~(residence_state;js)",
		"zip":"~(residence_zip;js)"
	},
	{
		"email":"~(email;js)",
		"homephone":"~(phone1;js)",
		"cellphone":"~(phone2;js)",
		"workphone":"~(phone3;js)",
		"employer":"~(employer;js)"
	},
	"<button class='editcontact'>Edit</button><br /><button class='deletecontact'>Delete</button>",
	"~(priority;js)",
	"~(last_name;js), ~(first_name;js)"
]
[/tlist_sql]
[/if#req]
~[if#req.~[gpv:action]=deletecontact]
<form action="/admin/changesrecorded.white.html" method="POST">
<input name="~(JSFieldParam;[Students]contact~[gpv:gidx]_ecpriority)" value="" />
<input name="~(JSFieldParam;[Students]contact~[gpv:gidx]_first)" value="" />
<input name="~(JSFieldParam;[Students]contact~[gpv:gidx]_last)" value="" />
<input name="~(JSFieldParam;[Students]contact~[gpv:gidx]_rel)" value="" />
<input name="~(JSFieldParam;[Students]contact~[gpv:gidx]_street)" value="" />
<input name="~(JSFieldParam;[Students]contact~[gpv:gidx]_city)" value="" />
<input name="~(JSFieldParam;[Students]contact~[gpv:gidx]_state)" value="" />
<input name="~(JSFieldParam;[Students]contact~[gpv:gidx]_zip)" value="" />
<input name="~(JSFieldParam;[Students]contact~[gpv:gidx]_recvmail)" value="" />
<input name="~(JSFieldParam;[Students]contact~[gpv:gidx]_email)" value="" />
<input name="~(JSFieldParam;[Students]contact~[gpv:gidx]_homephone)" value="" />
<input name="~(JSFieldParam;[Students]contact~[gpv:gidx]_workphone)" value="" />
<input name="~(JSFieldParam;[Students]contact~[gpv:gidx]_cellphone)" value="" />
<input name="~(JSFieldParam;[Students]contact~[gpv:gidx]_employer)" value="" />
<input name="ac" value="prim" />
</form>
[/if#req]
~[if#req.~[gpv:action]=addcontact]
~[tlist_sql;
SELECT
    CASE
        WHEN MAX(contact_id) + 1 is null
        THEN 1
    ELSE MAX(contact_id) + 1
    END AS newcontactid

from (

select * from U_STUDENT_CONTACTS4
where studentsdcid=~[gpv:sdcid]
union all
select * from U_STUDENT_CONTACTS_staging4
where studentsdcid=~[gpv:sdcid]

)]
{"contactnumber":~(n;l)}
[/tlist_sql]
[/if#req]
~[if#req.~[gpv:action]=fetchcontacts]
    ~[tlist_sql;
        select contact_id
        FROM u_student_contacts4
        WHERE studentsdcid=~[gpv:sdcid]
        ORDER BY contact_id asc]
    refreshContact(~(contact_id));
    [/tlist_sql]
[/if#req]
~[if#req.~[gpv:action]=geteditform]
<form id="ceditform~[gpv:gidx]" name="ceditform~[gpv:gidx]" method="post" action="studentcontacts.html" >

<table  class="datatable" border="1" cellpadding="4" cellspacing="0" align="center" style="width:98% !important;">
<tr class="inforow">
<td colspan="4" class="bold">Modify Contact Information</td>
</tr>

<tr>
	<td class="bold">Name (last, first):</td>
	<td class="bold">
		<input type="text" name="CF-[STUDENTS:~(rn;t).U_STUDENT_INFO.U_STUDENT_CONTACTS4:~[tlist_sql; select id from u_student_contacts4 where studentsdcid=~(rn) and contact_id=~[gpv:gidx]]~(id)[/tlist_sql]]last_name" id="last_name" value="" size="15" />,

<tr>
    <td colspan="4" align="right">
        <!--end hidden sync fields.txt -->
        <input type="hidden" name="ac" value="prim" />
        <button id="cancelbtn~[gpv:gidx]" class="button edit_cancel" type="button">Cancel</button>
        <button id="submitbtn~[gpv:gidx]" type="submit">Submit</button>
    </td>
</tr>
</table>
</form>
<!-- END PARENT CONTENT TABLE -->
[/if#req]